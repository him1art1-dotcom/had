<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="classic">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>حاضر | لوحة المراقبة</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="css/tokens.css" />
    <link rel="stylesheet" href="css/supervisor.css" />
    <script defer src="./sql-wasm.js"></script>
  </head>
  <body>
    <div class="page-root">
      <div class="school-lock" data-school-lock hidden>
        <div
          class="school-lock__dialog"
          data-school-lock-dialog
          role="alertdialog"
          aria-modal="true"
          tabindex="-1"
        >
          <span class="school-lock__light" aria-hidden="true"></span>
          <div class="school-lock__content">
            <h2 class="school-lock__title">تم إيقاف المدرسة</h2>
            <p class="school-lock__message" data-school-lock-message>راجع الدعم الفني</p>
          </div>
        </div>
      </div>
      <main class="supervisor-shell">
      <header class="supervisor-header">
        <div class="header-copy">
          <span class="badge">متابعة فورية</span>
          <p class="supervisor-school" data-school-name hidden></p>
          <h1>لوحة المراقبة</h1>
          <p>
            راقب حالة حضور الطلاب لحظيًا، وأرسل تقارير المراقبة مباشرة إلى بوابة الإشراف.
            يتم تحديث القوائم تلقائيًا بناءً على تسجيلات بوابة الحضور وإعدادات الوقت من الإدارة.
          </p>
        </div>
        <div class="supervisor-meta">
          <div class="meta-block">
            <span class="meta-label">اليوم</span>
            <span class="meta-value" data-day-label>—</span>
          </div>
          <div class="meta-block">
            <span class="meta-label">آخر تحديث</span>
            <span class="meta-value" data-last-update>—</span>
          </div>
          <div class="signal-indicator" data-store-indicator data-state="local">
            <span class="signal-indicator__light" aria-hidden="true"></span>
            <div class="signal-indicator__body">
              <span class="signal-indicator__title">إشارة مضيئة</span>
              <span class="signal-indicator__label" data-store-label>غير متصل</span>
              <span class="signal-indicator__message" data-store-message>راجع الدعم الفني</span>
            </div>
            <div class="signal-indicator__controls">
              <button type="button" class="ghost" data-refresh>تحديث الآن</button>
            </div>
          </div>
        </div>
        <div class="dispatch-panel">
          <button type="button" class="primary" data-dispatch-now>
            <span>إرسال التقارير</span>
          </button>
          <div class="dispatch-panel__schedule">
            <label>
              توقيت الإرسال التلقائي
              <input type="time" data-dispatch-time value="08:00" />
            </label>
            <div class="dispatch-panel__actions">
              <button type="button" class="ghost" data-dispatch-toggle>تفعيل الجدولة</button>
              <p class="dispatch-panel__status" data-dispatch-status>الإرسال اليدوي فقط.</p>
            </div>
          </div>
        </div>
      </header>

      <section class="supervisor-summary">
        <div class="summary-card is-present">
          <span class="summary-count" data-present-count>0</span>
          <span class="summary-label">حاضر</span>
        </div>
        <div class="summary-card is-late">
          <span class="summary-count" data-late-count>0</span>
          <span class="summary-label">متأخر</span>
        </div>
        <div class="summary-card is-absent">
          <span class="summary-count" data-absent-count>0</span>
          <span class="summary-label">غائب</span>
        </div>
      </section>

      <section class="supervisor-lists">
        <article class="attendance-card" data-list="present">
          <header class="attendance-card__header">
            <div>
              <h2>قائمة «حاضر»</h2>
              <p><span data-count-present>0</span> طالب مسجل في الوقت المحدد.</p>
            </div>
            <div class="attendance-card__actions" data-export-controls="present">
              <button type="button" data-export-button data-format="csv" data-list="present">CSV</button>
              <button type="button" data-export-button data-format="html" data-list="present">HTML</button>
              <button type="button" data-export-button data-format="pdf" data-list="present">PDF</button>
              <button type="button" data-export-button data-format="print" data-list="present">طباعة</button>
            </div>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الاسم</th>
                  <th>الرقم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت الوصول</th>
                </tr>
              </thead>
              <tbody data-list-body="present"></tbody>
            </table>
          </div>
          <p class="attendance-empty" data-empty="present">لا يوجد طلاب في هذه القائمة حتى الآن.</p>
          <p class="attendance-footnote">يتم إدراج الطلاب بحسب الصف ثم الفصل ثم الاسم أبجديًا.</p>
        </article>

        <article class="attendance-card" data-list="late">
          <header class="attendance-card__header">
            <div>
              <h2>قائمة «متأخر»</h2>
              <p><span data-count-late>0</span> طالب مسجل بعد وقت السماح.</p>
            </div>
            <div class="attendance-card__actions" data-export-controls="late">
              <button type="button" data-export-button data-format="csv" data-list="late">CSV</button>
              <button type="button" data-export-button data-format="html" data-list="late">HTML</button>
              <button type="button" data-export-button data-format="pdf" data-list="late">PDF</button>
              <button type="button" data-export-button data-format="print" data-list="late">طباعة</button>
            </div>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الاسم</th>
                  <th>الرقم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت الوصول</th>
                </tr>
              </thead>
              <tbody data-list-body="late"></tbody>
            </table>
          </div>
          <p class="attendance-empty" data-empty="late">لم يتم تسجيل أي تأخر حتى الآن.</p>
          <p class="attendance-footnote">يتم إدراج الطلاب بحسب الصف ثم الفصل ثم الاسم أبجديًا.</p>
        </article>

        <article class="attendance-card" data-list="absent">
          <header class="attendance-card__header">
            <div>
              <h2>قائمة «غائب»</h2>
              <p><span data-count-absent>0</span> طالب لم يسجل حضوره بعد.</p>
            </div>
            <div class="attendance-card__actions" data-export-controls="absent">
              <button type="button" data-export-button data-format="csv" data-list="absent">CSV</button>
              <button type="button" data-export-button data-format="html" data-list="absent">HTML</button>
              <button type="button" data-export-button data-format="pdf" data-list="absent">PDF</button>
              <button type="button" data-export-button data-format="print" data-list="absent">طباعة</button>
            </div>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الاسم</th>
                  <th>الرقم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت الوصول</th>
                </tr>
              </thead>
              <tbody data-list-body="absent"></tbody>
            </table>
          </div>
          <p class="attendance-empty" data-empty="absent">لا يزال جميع الطلاب في قائمة الغائبين.</p>
          <p class="attendance-footnote">يتم إدراج الطلاب بحسب الصف ثم الفصل ثم الاسم أبجديًا.</p>
        </article>
      </section>
      </main>
      <footer class="site-footer" role="contentinfo">© جميع الحقوق محفوظة | أ. هيثم الزهراني | Him.Art</footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="./js/env.js"></script>
    <script type="module" src="js/store/backend-factory.js"></script>
    <script type="module" src="js/backend-otherrest.js"></script>
    <script type="module" src="js/backend-supabase.js"></script>
    <script type="module" src="js/storage-ls.js"></script>
    <script type="module" src="js/storage-sql.js"></script>
    <script type="module" src="js/theme-utils.js"></script>
    <script type="module" src="js/remote-sync.js"></script>
    <script type="module" src="js/supervisor.js"></script>
    <script type="module">
      import { registerBackend } from './js/store/backend-factory.js';
      import localBackend from './js/store/backend-localstorage.js';
      import sqljsBackend from './js/store/backend-sqljs.js';
      import supabaseBackend from './js/store/backend-supabase.js';

      registerBackend(localBackend.name, localBackend);
      registerBackend(sqljsBackend.name, sqljsBackend);
      registerBackend(supabaseBackend.name, supabaseBackend);
    </script>
  </body>
</html>
