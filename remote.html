<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>الواجهة السحابية للمشرفين — حاضر</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script>
  (function () {
    var ACCENT_SCALE_STOPS = [100, 200, 300, 400, 500, 600, 700, 800, 900];
    var ACCENT_SCALE_CONFIG = {
      100: { lighten: 0.7 },
      200: { lighten: 0.55 },
      300: { lighten: 0.4 },
      400: { lighten: 0.2 },
      500: {},
      600: { darken: 0.16 },
      700: { darken: 0.28 },
      800: { darken: 0.42 },
      900: { darken: 0.58 }
    };

    function clamp01(value) {
      if (!isFinite(value)) return 0;
      if (value < 0) return 0;
      if (value > 1) return 1;
      return value;
    }

    function rgbToHex(r, g, b) {
      function toHex(component) {
        var clamped = Math.max(0, Math.min(255, Math.round(component)));
        var hex = clamped.toString(16);
        return hex.length === 1 ? '0' + hex : hex;
      }

      return '#' + toHex(r) + toHex(g) + toHex(b);
    }

    function formatRgb(r, g, b) {
      return Math.round(r) + ', ' + Math.round(g) + ', ' + Math.round(b);
    }

    function rgbToHsl(r, g, b) {
      var rn = clamp01(r / 255);
      var gn = clamp01(g / 255);
      var bn = clamp01(b / 255);
      var max = Math.max(rn, gn, bn);
      var min = Math.min(rn, gn, bn);
      var delta = max - min;
      var h = 0;

      if (delta !== 0) {
        if (max === rn) {
          h = ((gn - bn) / delta) % 6;
        } else if (max === gn) {
          h = (bn - rn) / delta + 2;
        } else {
          h = (rn - gn) / delta + 4;
        }
      }

      h = Math.round(((h * 60 + 360) % 360) * 1000) / 1000;
      var l = clamp01((max + min) / 2);
      var s = 0;
      if (delta !== 0) {
        s = delta / (1 - Math.abs(2 * l - 1));
      }

      return { h: h, s: clamp01(s), l: l };
    }

    function hslToRgb(h, s, l) {
      var hue = ((h % 360) + 360) % 360 / 360;
      var sat = clamp01(s);
      var light = clamp01(l);

      if (sat === 0) {
        var value = Math.round(light * 255);
        return { r: value, g: value, b: value };
      }

      var q = light < 0.5 ? light * (1 + sat) : light + sat - light * sat;
      var p = 2 * light - q;

      function hue2rgb(t) {
        var temp = t;
        if (temp < 0) temp += 1;
        if (temp > 1) temp -= 1;
        if (temp < 1 / 6) return p + (q - p) * 6 * temp;
        if (temp < 1 / 2) return q;
        if (temp < 2 / 3) return p + (q - p) * (2 / 3 - temp) * 6;
        return p;
      }

      return {
        r: Math.round(hue2rgb(hue + 1 / 3) * 255),
        g: Math.round(hue2rgb(hue) * 255),
        b: Math.round(hue2rgb(hue - 1 / 3) * 255)
      };
    }

    function createAccentScale(baseHsl) {
      var scale = {};
      ACCENT_SCALE_STOPS.forEach(function (stop) {
        var config = ACCENT_SCALE_CONFIG[stop] || {};
        var lightness = baseHsl.l;
        var saturation = baseHsl.s;

        if (typeof config.lighten === 'number') {
          var amountLight = clamp01(config.lighten);
          lightness = clamp01(baseHsl.l + (1 - baseHsl.l) * amountLight);
          saturation = clamp01(baseHsl.s * (1 - amountLight * 0.35));
        } else if (typeof config.darken === 'number') {
          var amountDark = clamp01(config.darken);
          lightness = clamp01(baseHsl.l * (1 - amountDark));
          saturation = clamp01(baseHsl.s * (1 + amountDark * 0.25));
        }

        var next = hslToRgb(baseHsl.h, saturation, lightness);
        scale[stop] = {
          hex: rgbToHex(next.r, next.g, next.b),
          rgb: formatRgb(next.r, next.g, next.b)
        };
      });

      return scale;
    }

    try {
      var storageKey = 'hader:theme';
      var defaultAccent = '#2f80ed';
      var rawTheme = null;
      try {
        rawTheme = localStorage.getItem(storageKey);
      } catch (storageError) {
        rawTheme = null;
      }

      var parsed = null;
      var mode = 'system';
      var accent = defaultAccent;

      if (typeof rawTheme === 'string' && rawTheme.length) {
        if (rawTheme.trim().charAt(0) === '{') {
          try {
            parsed = JSON.parse(rawTheme);
          } catch (parseError) {
            parsed = null;
            mode = rawTheme;
          }
        } else {
          mode = rawTheme;
        }
      }

      if (parsed && typeof parsed === 'object') {
        if (typeof parsed.mode === 'string') {
          mode = parsed.mode;
        }
        if (typeof parsed.accent === 'string') {
          accent = parsed.accent;
        }
      }

      if (mode !== 'light' && mode !== 'dark' && mode !== 'system') {
        mode = 'system';
      }

      var accentOverride = null;
      try {
        accentOverride = localStorage.getItem('hader:accent');
      } catch (accentError) {
        accentOverride = null;
      }

      if (typeof accentOverride === 'string' && accentOverride) {
        accent = accentOverride;
      }

      if (!/^#?[0-9a-fA-F]{6}$/.test(accent)) {
        accent = defaultAccent;
      }

      if (accent.charAt(0) !== '#') {
        accent = '#' + accent;
      }

      var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      var theme = mode === 'dark' || (mode === 'system' && prefersDark) ? 'dark' : 'light';
      var root = document.documentElement;
      var rootStyle = root.style;
      root.setAttribute('data-theme', theme);
      root.dataset.themeMode = mode;

      var hex = accent.slice(1);
      var r = parseInt(hex.slice(0, 2), 16);
      var g = parseInt(hex.slice(2, 4), 16);
      var b = parseInt(hex.slice(4, 6), 16);

      if (Number.isNaN(r) || Number.isNaN(g) || Number.isNaN(b)) {
        return;
      }

      var accentLower = accent.toLowerCase();
      rootStyle.setProperty('--adm-accent', accentLower);
      rootStyle.setProperty('--adm-accent-rgb', formatRgb(r, g, b));
      rootStyle.setProperty('--btn-bg', accentLower);

      var rn = r / 255;
      var gn = g / 255;
      var bn = b / 255;
      var transform = function (channel) {
        return channel <= 0.03928 ? channel / 12.92 : Math.pow((channel + 0.055) / 1.055, 2.4);
      };
      var luminance = 0.2126 * transform(rn) + 0.7152 * transform(gn) + 0.0722 * transform(bn);
      var contrast = luminance > 0.55 ? '#041124' : '#ffffff';
      rootStyle.setProperty('--adm-accent-contrast', contrast);
      rootStyle.setProperty('--btn-text', contrast);

      var baseHsl = rgbToHsl(r, g, b);
      var scale = createAccentScale(baseHsl);
      scale[500] = { hex: accentLower, rgb: formatRgb(r, g, b) };

      ACCENT_SCALE_STOPS.forEach(function (stop) {
        var entry = scale[stop];
        if (!entry) return;
        rootStyle.setProperty('--adm-accent-' + stop, entry.hex);
        rootStyle.setProperty('--adm-accent-' + stop + '-rgb', entry.rgb);
      });
      rootStyle.setProperty('--adm-accent-500', accentLower);
      rootStyle.setProperty('--adm-accent-500-rgb', formatRgb(r, g, b));

      var hoverHex = scale[600] ? scale[600].hex : accentLower;
      var activeHex = scale[700] ? scale[700].hex : accentLower;
      rootStyle.setProperty('--btn-bg-hover', hoverHex);
      rootStyle.setProperty('--btn-bg-active', activeHex);

      var mixComponent = function (component, target, ratio) {
        return Math.round(component + (target - component) * ratio);
      };
      var toHex = function (value) {
        var hexValue = value.toString(16);
        return hexValue.length === 1 ? '0' + hexValue : hexValue;
      };

      var mixRatio = theme === 'dark' ? 0.32 : 0.18;
      var mixTarget = theme === 'dark' ? 255 : 0;
      var mixR = mixComponent(r, mixTarget, mixRatio);
      var mixG = mixComponent(g, mixTarget, mixRatio);
      var mixB = mixComponent(b, mixTarget, mixRatio);

      rootStyle.setProperty('--brand-accent', '#' + toHex(mixR) + toHex(mixG) + toHex(mixB));
      rootStyle.setProperty('--brand-accent-rgb', mixR + ', ' + mixG + ', ' + mixB);

      var overlayAlpha = theme === 'dark' ? 0.28 : 0.22;
      var overlayStrongAlpha = theme === 'dark' ? 0.36 : 0.3;
      rootStyle.setProperty('--surface-overlay', 'rgba(' + r + ', ' + g + ', ' + b + ', ' + overlayAlpha + ')');
      rootStyle.setProperty('--surface-overlay-strong', 'rgba(' + r + ', ' + g + ', ' + b + ', ' + overlayStrongAlpha + ')');
    } catch (error) {
      /* تجاهل أي أخطاء في القراءة المسبقة */
    }
  })();
</script>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/tokens.css" />
    <link rel="stylesheet" href="css/remote.css" />
    <script src="js/theme.js"></script>
  </head>
  <body>
    <div class="remote-shell">
      <header class="remote-header">
        <h1>بوابة التقارير السحابية للمشرفين</h1>
        <p>
          تتيح هذه الواجهة للمشرفين الوصول إلى قوائم الحضور، الغياب، والتأخر التي يصدرها جهاز تسجيل الطلاب بعد مشاركة
          البيانات من لوحة الإدارة. يمكنك تنزيل القوائم أو تحديثها فور وصول إشعار بمشاركة جديدة.
        </p>
      </header>

      <section class="connection-card">
        <form data-connection-form>
          <div class="connection-grid">
            <div class="field">
              <label for="remote-endpoint">رابط الخدمة السحابية</label>
              <input
                id="remote-endpoint"
                type="url"
                name="endpoint"
                placeholder="https://example.com/api/remote-report"
                required
                data-endpoint
              />
              <p class="form-hint">يجب أن يكون الرابط مطابقًا لما تم ضبطه في لوحة الإدارة.</p>
            </div>
            <div class="field">
              <label for="remote-school">رمز المدرسة</label>
              <input id="remote-school" type="text" name="school" autocomplete="off" required data-school-code />
            </div>
            <div class="field">
              <label for="remote-token">رمز الدخول (اختياري)</label>
              <input id="remote-token" type="text" name="token" autocomplete="off" placeholder="Bearer token" data-token />
              <p class="form-hint">استخدمه إذا تطلبت الخدمة مصادقة.</p>
            </div>
            <div class="field">
              <label for="remote-supervisor">نوع الإشراف</label>
              <select id="remote-supervisor" name="supervisor" data-supervisor>
                <option value="all">جميع المشرفين</option>
              </select>
              <p class="form-hint">اختر نطاق التقارير الذي ترغب في استعراضه.</p>
            </div>
            <div class="field">
              <label for="remote-day">تاريخ اليوم</label>
              <input id="remote-day" type="date" name="day" data-day />
            </div>
            <div class="field">
              <label class="checkbox">
                <input type="checkbox" name="autoRefresh" checked data-auto-refresh />
                <span>تحديث تلقائي عند وصول تقرير جديد</span>
              </label>
            </div>
          </div>
          <div class="connection-actions">
            <button type="submit" class="primary" data-fetch>تحديث التقرير الآن</button>
            <button type="button" class="secondary" data-download="present">تحميل قائمة الحضور</button>
            <button type="button" class="secondary" data-download="late">تحميل قائمة المتأخرين</button>
            <button type="button" class="secondary" data-download="absent">تحميل قائمة الغياب</button>
            <span class="status-label" data-status data-state="idle">جاهز للتحديث.</span>
          </div>
        </form>
      </section>

      <section class="remote-summary">
        <div class="summary-grid">
          <article class="summary-card">
            <h2 class="summary-card__label">إجمالي الطلاب</h2>
            <p class="summary-card__value" data-summary-total>0</p>
          </article>
          <article class="summary-card">
            <h2 class="summary-card__label">مسجلون حضورهم</h2>
            <p class="summary-card__value" data-summary-present>0</p>
          </article>
          <article class="summary-card summary-card--late">
            <h2 class="summary-card__label">متأخرون</h2>
            <p class="summary-card__value" data-summary-late>0</p>
          </article>
          <article class="summary-card summary-card--absent">
            <h2 class="summary-card__label">غائبون</h2>
            <p class="summary-card__value" data-summary-absent>0</p>
          </article>
        </div>
        <div class="summary-meta">
          <span>آخر مشاركة: <strong data-summary-generated>—</strong></span>
          <span>جدول المزامنة: <strong data-summary-schedule>—</strong></span>
        </div>
      </section>

      <section class="leave-card">
        <header class="leave-card__header">
          <div>
            <h2>إرسال طلب استئذان إلى الجهاز الرئيسي</h2>
            <p>
              استخدم هذا النموذج لرفع طلب خروج عاجل، وسيقوم الجهاز A بحفظه في قاعدة البيانات عند المزامنة القادمة.
            </p>
          </div>
        </header>
        <form class="leave-card__form" data-leave-form>
          <div class="leave-grid">
            <div class="field">
              <label for="leave-student-id">رقم الطالب</label>
              <input id="leave-student-id" type="text" inputmode="numeric" required data-leave-student-id />
            </div>
            <div class="field">
              <label for="leave-student-name">اسم الطالب (اختياري)</label>
              <input id="leave-student-name" type="text" data-leave-student-name />
            </div>
            <div class="field">
              <label for="leave-grade">الصف (اختياري)</label>
              <input id="leave-grade" type="text" data-leave-grade />
            </div>
            <div class="field">
              <label for="leave-class">الفصل (اختياري)</label>
              <input id="leave-class" type="text" data-leave-class />
            </div>
            <div class="field field--wide">
              <label for="leave-reason">سبب الاستئذان</label>
              <input id="leave-reason" type="text" required data-leave-reason />
            </div>
            <div class="field field--wide">
              <label for="leave-note">ملاحظات إضافية (اختياري)</label>
              <textarea id="leave-note" rows="3" data-leave-note></textarea>
            </div>
            <div class="field">
              <label for="leave-supervisor-name">اسم المشرف المرسل</label>
              <input id="leave-supervisor-name" type="text" required data-leave-supervisor-name />
              <p class="form-hint">يُحفظ لتعبئته تلقائيًا في المستقبل.</p>
            </div>
            <div class="field">
              <label for="leave-supervisor-contact">وسيلة التواصل (اختياري)</label>
              <input id="leave-supervisor-contact" type="text" data-leave-supervisor-contact />
            </div>
          </div>
          <div class="leave-actions">
            <button type="submit" class="primary" data-leave-submit>إرسال الطلب</button>
            <p class="status-label" data-leave-status data-state="idle">جاهز لإرسال الطلب.</p>
          </div>
        </form>
      </section>

      <section class="tables-section">
        <article class="table-card" data-table="present">
          <header>
            <h2>قائمة الحضور</h2>
            <button type="button" class="secondary" data-download="present">تنزيل CSV</button>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الرقم</th>
                  <th>الاسم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت التسجيل</th>
                  <th>دقائق التأخر</th>
                </tr>
              </thead>
              <tbody data-table-body="present"></tbody>
            </table>
          </div>
          <div class="empty-state" data-empty-state="present">لا توجد بيانات مسجلة بعد.</div>
        </article>

        <article class="table-card" data-table="late">
          <header>
            <h2>قائمة المتأخرين</h2>
            <button type="button" class="secondary" data-download="late">تنزيل CSV</button>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الرقم</th>
                  <th>الاسم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت التسجيل</th>
                  <th>دقائق التأخر</th>
                </tr>
              </thead>
              <tbody data-table-body="late"></tbody>
            </table>
          </div>
          <div class="empty-state" data-empty-state="late">لا توجد حالات تأخر مسجلة.</div>
        </article>

        <article class="table-card" data-table="absent">
          <header>
            <h2>قائمة الغياب</h2>
            <button type="button" class="secondary" data-download="absent">تنزيل CSV</button>
          </header>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>الرقم</th>
                  <th>الاسم</th>
                  <th>الصف</th>
                  <th>الفصل</th>
                  <th>وقت التسجيل</th>
                  <th>دقائق التأخر</th>
                </tr>
              </thead>
              <tbody data-table-body="absent"></tbody>
            </table>
          </div>
          <div class="empty-state" data-empty-state="absent">لا توجد بيانات غياب حتى الآن.</div>
        </article>
      </section>
      <footer class="site-footer">© جميع الحقوق محفوظة | أ. هيثم الزهراني | Him.Art</footer>
    </div>

    <div class="toast" data-toast data-state="hidden"></div>
    <script src="js/remote-sync.js" defer></script>
    <script src="js/remote.js" defer></script>
  </body>
</html>
