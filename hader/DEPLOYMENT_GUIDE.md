# دليل النشر على Vercel وربط Supabase

يوضح هذا الدليل خطوات نشر التطبيق على Vercel وضبط قاعدة البيانات على Supabase، مع تضمين سكربت SQL لإنشاء الجداول الأساسية.

## 1) متطلبات مبدئية
- حساب Vercel مفعّل وربط مع GitHub أو GitLab أو Bitbucket.
- حساب Supabase ومشروع جديد (أو مشروع قائم) لتخزين البيانات.
- مفاتيح واجهة برمجة التطبيقات من Supabase: `VITE_SUPABASE_URL` و`VITE_SUPABASE_ANON_KEY`.

## 2) إعداد قاعدة البيانات في Supabase
1. ادخل إلى لوحة Supabase واختر المشروع المطلوب.
2. افتح تبويب **SQL** ثم الصق محتوى ملف [`supabase_schema.sql`](./supabase_schema.sql) كاملاً وشغّله مرة واحدة لإنشاء الجداول والقيود الابتدائية.
3. تأكد من إضافة صف افتراضي في جدول `settings` (موجود في السكربت) أو حدّثه بما يناسب مدرستك.
4. في حال تفعيل سياسات RLS، عيّن سياسات تسمح بالقراءة/الكتابة حسب الأدوار المناسبة أو عطّل RLS للجداول المذكورة أثناء التطوير.

### المتغيرات البيئية المطلوبة
أضف المتغيرات التالية في إعدادات بيئة Supabase Functions أو في Vercel (يتم استهلاكها في الواجهة الأمامية):
- `VITE_SUPABASE_URL`: رابط مشروع Supabase (مثال: `https://YOUR-PROJECT.supabase.co`).
- `VITE_SUPABASE_ANON_KEY`: مفتاح anon العمومي للمشروع.

## 3) نشر الواجهة على Vercel
1. **استيراد المشروع**: من Vercel اختر “Add New Project” ثم استورد المستودع من Git.
2. **إعداد البناء**:
   - Framework Preset: اختر `Vite`.
   - Build Command: `npm run build` (القيمة الافتراضية في `package.json`).
   - Output Directory: `dist`.
3. **المتغيرات البيئية**: في تبويب **Environment Variables** أضف:
   - `VITE_SUPABASE_URL`
   - `VITE_SUPABASE_ANON_KEY`
4. **النشر**: اضغط Deploy. سيبني Vercel المشروع ويستخدم `dist` كمخرجات.
5. **المراجعة**: بعد الإطلاق، افتح الرابط المولَّد وتأكد من أن الاتصال بالسحابة ناجح (من شاشة الدعم يظهر وضع الاتصال).

## 4) تشغيل محلياً مع إعدادات Vercel
إن رغبت في تجربة الإعداد نفسه محلياً:
1. أنشئ ملف `.env.local` في جذر المشروع وضع فيه مفاتيح Supabase كما يلي:
   ```bash
   VITE_SUPABASE_URL=https://YOUR-PROJECT.supabase.co
   VITE_SUPABASE_ANON_KEY=YOUR-ANON-KEY
   ```
2. ثبّت الاعتماديات ثم شغّل:
   ```bash
   npm install
   npm run dev
   ```
3. افتح المتصفح على الرابط الذي يظهر (عادة `http://localhost:5173`).

## 5) فحص الاتصال أثناء التشغيل
- من لوحة **الدعم** في التطبيق يمكنك إعادة فحص الاتصال بالسحابة.
- عند غياب المتغيرات البيئية سيبقى التطبيق في وضع التخزين المحلي ويظهر تنبيه يطلب إضافة مفاتيح Supabase.

## 6) استيراد/تحديث البيانات
- استخدم سكربت [`supabase_schema.sql`](./supabase_schema.sql) لإعادة بناء الجداول أو تحديثها.
- يمكن ضخ بيانات أولية (طلاب/فصول/مستخدمين) عبر نفس السكربت أو عبر واجهة Supabase Table Editor.

